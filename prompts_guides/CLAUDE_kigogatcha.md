# CLAUDE.md - 季語ガチャ機能実装仕様書

## 📋 概要
俳句アプリに初心者向けの季語ガチャ機能を実装します。初めて俳句に触れるユーザーに対して、キュレーションされた基本季語からランダムに1つを提示し、俳句作成への導線を提供します。

## 🎯 実装目的
- 俳句初心者の参入障壁を下げる
- 季語選びの楽しさを提供する
- 俳句作成への自然な導線を作る
- 参考サイト（kigo-gacha.vercel.app）との差別化：初心者に優しいキュレーション

## 🎰 基本機能

### 起動タイミング
**1. 初回訪問時（ウェルカムフロー）**
- 独立したウェルカムページを表示
- 質問文：「俳句は、」
- 2つの選択肢ボタン：
  - 「普段から詠んでる」→ トップページへ遷移
  - 「初めて！」→ 季語ガチャ + 簡単な説明を表示
- localStorage等で初回訪問判定を実装

**2. 通常時のアクセス**
- ハンバーガーメニューに「季語ガチャ」項目を追加
- いつでもアクセス可能

### ガチャ動作
- **表示数**: 1つの季語のみ
- **もう一回機能**: 実装する
- **重複回避**: 既に表示された季語は再表示しない（セッション内で管理）

### 季語データ
- **データ量**: 約1,000件の基本季語
- **データ形式**: 文字列配列で直接コードに埋め込み
- **季節フィルター**: 現在の時期から季節を自動判定して該当季節の季語のみ表示
- **選定基準**: 手動でキュレーションされた初心者向けリスト

## 🎨 UI/UXデザイン

### 表示内容
- **季語のみ**を大きく表示（読み、説明、例句は含めない）
- シンプル&モダンなデザイン
- ガチャ演出なし（アニメーション・効果音なし）

### 季節別ビジュアル
季語ガチャボタンを季節ごとに色分け（styles.cssに準拠）
- 春: 
- 夏: 
- 秋: 
- 冬: 
※具体的な色は既存のstyles.cssから引用

### 画面遷移フロー
```
[ウェルカム画面]
「俳句は、」
├─「普段から詠んでる」→ [トップページ]
└─「初めて！」→ [季語ガチャ説明 + ガチャボタン]
                    ↓
                 [季語表示画面]
                 「季語: ○○○」
                 ├─「次へ」(プライマリカラー) → [俳句入力画面]
                 └─「やり直す」(セカンダリーカラー) → [季語ガチャに戻る]
                    ↓
                 [俳句入力画面]
                 - 季語サジェスト機能利用可能
                 - 「詠んだ！」ボタン → [現在地へ投稿]
```

### ボタン配色
- **「次へ」ボタン**: プライマリカラー
- **「やり直す」ボタン**: セカンダリーカラー
- **季語ガチャボタン**: 季節別カラー

## 🔗 既存機能との統合

### 季語サジェスト機能
季語ガチャの「次へ」ボタン押下後、俳句入力画面で季語サジェスト機能を利用可能

### 投稿機能
- 俳句入力画面に「詠んだ！」ボタンを配置
- 現在地への投稿機能
- 位置情報アクセス拒否時のフォールバック: デフォルト住所（東京都千代田区）

### データベース連携
- 現時点: 文字列配列で直接埋め込み
- 将来展望: データベースから取得する方式への移行を検討

## 💾 データ構造

### 季語データの形式
```javascript
const kigoData = {
  spring: ["桜", "春風", "若葉", ...],  // 春の季語リスト
  summer: ["蝉", "夏雲", "夕立", ...],  // 夏の季語リスト
  autumn: ["紅葉", "秋風", "月", ...],  // 秋の季語リスト
  winter: ["雪", "冬空", "霜", ...]     // 冬の季語リスト
};
```

### 状態管理
```javascript
// localStorage
{
  isFirstVisit: boolean,           // 初回訪問フラグ
  usedKigo: string[],              // 使用済み季語リスト（セッション内）
}
```

## 🛠️ 実装要件

### 季節判定ロジック
現在の月から季節を自動判定:
- 春: 3月〜5月
- 夏: 6月〜8月
- 秋: 9月〜11月
- 冬: 12月〜2月

### 重複回避ロジック
- セッション内で使用済み季語を配列で管理
- 未使用の季語からランダムに選択
- 全て使い切った場合はリセット可能に

### レスポンシブ対応
- モバイルファースト
- 各画面でタッチ操作に最適化

## 📱 UI配置詳細

### ウェルカム画面（初回のみ）
- 中央配置
- 質問文 + 2つの大きなボタン
- シンプルで迷わないデザイン

### ハンバーガーメニュー
- 既存メニュー項目に「季語ガチャ」を追加
- アイコン: 🎲 または季節別アイコン

### 季語表示画面
- 季語を中央に大きく表示
- 下部に「次へ」「やり直す」ボタンを横並び配置

## 🚫 実装しない機能
- お気に入り・保存機能
- ガチャ履歴の表示
- SNSシェア機能
- 難易度設定
- 季語の詳細説明・読み・例句
- 設定リセット機能（ハンバーガーメニューから再アクセス可能なため）

## 📝 今後の拡張性
- データベース連携による季語データの動的取得
- 季語の詳細情報（読み、説明、例句）の追加

## ✅ 実装チェックリスト
- [x] 季語データ配列の準備（約1,200件） - `docs/js/kigo-gatcha.js`
- [x] ウェルカム画面の実装 - `docs/welcome.html`
- [x] 季語ガチャ画面の実装 - `docs/kigo-gatcha.html`
- [x] 季節判定ロジック - `docs/js/kigo-gatcha-logic.js`
- [x] 重複回避ロジック - `docs/js/kigo-gatcha-logic.js`
- [x] ハンバーガーメニューへの追加 - `docs/home.html`
- [x] 俳句入力画面との連携 - `docs/haiku-compose.html`で実装完了
- [x] 投稿機能との連携 - `apiAdapter.createHaiku()`を使用
- [x] 位置情報フォールバック処理 - デフォルト位置（東京都千代田区）実装済み
- [x] レスポンシブデザイン対応 - `docs/css/styles.css`で統一
- [x] localStorage実装 - 初回訪問判定、使用済み季語管理
- [x] styles.cssとの色統一 - 既存コンポーネント再利用で統一

---

## 📦 実装ファイル一覧

### 新規作成ファイル
- `docs/index.html` - ルーティングハブ（初回訪問判定、リダイレクト）
- `docs/welcome.html` - ウェルカム画面（初回訪問時のみ表示）
- `docs/kigo-gatcha.html` - 季語ガチャ画面
- `docs/haiku-compose.html` - 俳句作成画面（季語サジェスト機能付き）
- `docs/js/kigo-gatcha.js` - 季語辞書データ（約1,200件）
- `docs/js/kigo-gatcha-logic.js` - ガチャロジック（季節判定、重複回避など）

### 変更ファイル
- `docs/home.html` - 元の`index.html`をリネーム、ハンバーガーメニューに「🎲 季語ガチャ」追加
- `docs/css/styles.css` - 最小限の汎用スタイル追加（`.fullscreen-center`, `.gatcha-btn`など）

### アーキテクチャ改善
- **URL構造の整理**:
  - `/` (index.html) - ルーティングハブ
  - `/home.html` - 地図画面
  - `/welcome.html` - ウェルカム画面
  - `/kigo-gatcha.html` - 季語ガチャ
  - `/haiku-compose.html` - 俳句作成

- **CSS統一**:
  - 専用CSS (`kigo-gatcha.css`) を削除
  - 既存の `styles.css` のコンポーネント (`.primary-btn`, `.secondary-btn`, `.modal-content`, `.form-group`など) を再利用
  - 最小限の専用スタイルのみ追加

---

## 🔗 俳句入力画面との連携

### 実装済み
「次へ」ボタンで以下のURLに遷移:
```
haiku-compose.html?kigo=[選ばれた季語]&season=[季節]&seasonJa=[季節(日本語)]
```

`haiku-compose.html`で実装済みの機能:
- URLパラメータから季語情報を取得して表示
- 季語サジェスト機能の統合
- 現在地取得（失敗時は東京都千代田区をデフォルト）
- `apiAdapter.createHaiku()`を使用した投稿処理
- 詩人名の検索と自動マッチング

### sessionStorage連携
```javascript
sessionStorage.setItem('selectedKigo', JSON.stringify({
    kigo: "桜",
    season: "spring",
    seasonJa: "春"
}));
```

---

**作成日**: 2025年10月9日
**実装日**: 2025年10月10日
**バージョン**: 2.0
**ステータス**: 全機能完成（CSS統一リファクタリング完了）
**対象アプリ**: 俳句投稿アプリ

## 更新履歴
- **2025-10-10**: CSS統一リファクタリング完了
  - `kigo-gatcha.css`削除、既存コンポーネント再利用
  - URL構造整理（ルーティングハブ追加）
  - 俳句作成画面実装完了
  - 全機能統合テスト完了