# 季語バッチ割り付けシステム開発プロンプト

私は俳句管理システムで使用する季語自動割り付け機能を開発したいと思います。

## 要件

### 1. 背景
- 既存の俳句CSVファイルに対して、季語を自動で割り付けたい
- `kigo-suggestions.js`というモジュールがあり、Supabaseとの通信や季語マッチング機能が実装済み
- このモジュールの機能を活用してバッチ処理システムを作りたい

### 2. 既存モジュールの主要機能
- `initializeKigoDatabase()`: Supabaseから季語データを取得・初期化
- `extractKigo(haikuText)`: 俳句テキストから季語を抽出
- `kigoDatabase`: インメモリ季語データベース
- `kigoCache`: 高速検索用キャッシュ
- 季語データ構造: `{display_name, display_name_alternatives, season, description}`

### 3. 実装してほしい機能

#### CSVバッチ処理システム
1. **CSVファイル読み込み**
   - 俳句テキストを含むCSVファイルを処理
   - 一般的な俳句CSVフォーマット（俳句、作者、日付等）に対応

2. **季語自動割り付け**
   - 各俳句に対して`extractKigo()`を使用して季語を検出
   - 複数の季語が見つかった場合の優先順位処理もkigo-suggestions.jsに準拠
   - 季語が見つからない場合は「季なし」として処理

3. **結果出力**
   - 元のCSVデータに季語情報を追加
   - 新しいカラム: `keywords`（季語名）、`season`（季節）
   - 処理結果の統計情報出力

4. **エラーハンドリング**
   - ファイル読み込みエラー
   - 季語データベース初期化失敗
   - 処理中断時の途中保存

#### パフォーマンス考慮
- 大量データ処理に対応（数千〜数万件の俳句）
- プログレス表示
- メモリ効率的な処理

#### 使いやすさ
- コマンドライン実行可能
- 設定オプション（入力ファイル、出力ファイル、処理モード等）
- 詳細なログ出力

### 4. 技術要件
- Node.js環境での実行
- 既存の`kigo-suggestions.js`モジュールを`require`または`import`で利用
- CSVパースにはPapaParseまたは類似ライブラリを使用
- ES2020+の現代的なJavaScript記法を使用

### 5. サンプル出力イメージ
```
処理開始...
✅ 季語データベース初期化完了: 1,234件
📁 CSVファイル読み込み: sample.csv (500件)
🔍 季語マッチング処理中...
[████████████████████] 100% (500/500)
✅ 処理完了

統計情報:
- 総俳句数: 500件
- 季語検出: 423件 (84.6%)
- 季なし: 77件 (15.4%)
- 季節別内訳:
  春: 156件, 夏: 98件, 秋: 89件, 冬: 80件

📄 出力ファイル: sample_with_kigo.csv
```

## 依存する既存コード

以下のコードが既に実装されており、これらの機能を活用してください：

```javascript
// kigo-suggestions.js の主要な関数
- initializeKigoDatabase()
- extractKigo(haikuText)
- kigoDatabase
- kigoCache
```

## 期待する成果物

1. **メインスクリプトファイル**: `kigo-batch-processor.js`
2. **設定ファイル**: `batch-config.json` 
3. **使用方法ドキュメント**: 実行方法とオプション説明
4. **サンプルCSVファイル**: テスト用データ

この要件に基づいて、実用的で効率的な季語バッチ割り付けシステムを実装してください。